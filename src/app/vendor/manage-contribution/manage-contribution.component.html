<div class="card">
  	<div class="card-body" style="padding:0px;">
    	<div class="row">
      		<div class="col">
		        <tabset>
		          <tab heading="Manage Contributions">
			            <div class="container">
			            	<div _ngcontent-c4="" class="module-option clearfix">
					           <!-- <form class="pull-left" [formGroup] = "runContributionForm" (ngSubmit) = "runContribution(runContributionForm.value)">
					           	 	<div class="row">
					           	 		<div class="col-md-3">
		                      				<div class="form-group">
				                                <label>Contribution Plan</label>
				                                <select class="form-control" placeholder="type" formControlName = "plan_id">
				                                    <option selected="false">Type</option>
				                                    <option [value]="item.id" *ngFor="let item of contribution_plan_list">
				                                    	{{item?.name }}
				                                    </option>
				                                </select>
				                                <small [hidden]="(runContributionForm.controls.plan_id.valid ) || (runContributionForm.controls.plan_id.pristine )" class="text-danger">Period Method is Required</small>
				                            </div>
		                      			</div>
					                	<div class="col-md-3">
					                		 <label>Contribution Type</label>
					                		<select class="form-control" placeholder="Filter by name..." formControlName = "type">
						                        <option value="{{ item.id }}" *ngFor="let item of contribution_type_list">{{ item?.name }}</option>
						                    </select>
						                    <small [hidden]="(runContributionForm.controls.type.valid ) || (runContributionForm.controls.type.pristine )" class="text-danger">Type is Required</small> 
					                	</div>
							           	<div class="col-md-3">
							           		 <label>Period</label>
							           		<select class="form-control" placeholder="Period" formControlName = "period">
						                        <option *ngFor="let item of monthList">{{item.name}}/{{ current_year }}</option>
						                    </select>
						                    <small [hidden]="(runContributionForm.controls.period.valid ) || (runContributionForm.controls.period.pristine )" class="text-danger">Period Method is Required</small> 
							           	</div>
							           	<div class="col-md-3">
							           		 <button style="margin-top:30px" type="submit" class="btn btn-success" [disabled]="runContributionForm.invalid || submitPending ">
						                        <span *ngIf="!submitPending">Run Contribution</span>
						                        <span *ngIf="submitPending && runContributionForm.valid">Please Wait...</span>
						                        <span *ngIf="submitPending && runContributionForm.valid" class="fa fa-spinner" aria-hidden="true"></span>
						                    </button>
							           	</div>
					                </div>
					                <br>
					            </form> -->
					            <!-- <button class="btn btn-success" (click)="excelUploadModal.show()">Upload Excel Format</button> -->
					            <!-- <button *ngIf="!adv_filter" class="btn btn-success" style="margin-top:30px" (click)="show_adv_form()">Show Search</button>
					            <button *ngIf="adv_filter" class="btn btn-success" style="margin-top:30px" (click)="show_adv_form()">Hide Search</button> -->
					        </div>
					        <div class=""> <!-- *ngIf="adv_filter" -->
			            		<form [formGroup] = "filterForm" (ngSubmit) = "filterContribution(filterForm.value)">
                                    <div class="row">
                                    	<div class="col-md-3">
                                          <div class="form-group">
                                            <label>Transaction ID</label>
                                            <input type="text" formControlName = "transaction_id" class="form-control" name=""> 
                                          </div>
                                        </div>
                                        <div class="col-md-3">
                                          <div class="form-group">
                                            <label>From</label>
                                            <input type="date" formControlName = "from" class="form-control" name=""> 
                                          </div>
                                        </div>
                                        <div class="col-md-3">
                                          <div class="form-group">
                                            <label>To</label>
                                            <input type="date" formControlName = "to" class="form-control" name="">
                                          </div>
                                        </div>
                                        <div class="col-md-3">
		                      				<div class="form-group">
				                                <label>Contribution Plan</label>
				                                <select class="form-control" placeholder="type" formControlName = "plan_id">
				                                    <option selected="false">Type</option>
				                                    <option [value]="item.id" *ngFor="let item of contribution_plan_list">
				                                    	{{item?.name }}
				                                    </option>
				                                </select>
				                            </div>
		                      			</div>
		                      			<div class="col-md-3">
                                          <div class="form-group">
					                        <label for="typeahead-http">Filter By Staff <small>[Name/Staff ID]</small></label>
					                        <input id="typeahead-http" type="text" class="form-control" [class.is-invalid]="staff_searchFailed"formControlName="staff_id" [ngbTypeahead]="search_staff" placeholder="Filter By Staff" [inputFormatter]="staff_formatter" [resultTemplate]="st"/>
					                        <span *ngIf="staff_searching">searching...</span>
					                        <ng-template #st let-r="result" let-t="term">
					                        	<img *ngIf="!r.passport" src="assets/images/avata.png" class="img-avatar" width='39px'>
                                  				<img *ngIf="r.passport" src="{{staff_image_url}}{{r.passport}}" class="img-avatar" width='39px'>
					                           {{ r.first_name}} {{ r.last_name}} {{ r.middle_name}}
					                           <br>
					                           {{ r.staff_id}}
					                        </ng-template>
					                      </div>
                                        </div>
                                        <div class="col-md-3">
                                          <div class="form-group">
					                        <label for="typeahead-http">Filter Member <small>[name/Account no.]</small></label>
					                        <input id="typeahead-http" type="text" class="form-control" [class.is-invalid]="searchFailed"formControlName="member_id" [ngbTypeahead]="search" placeholder="Filter Member" [inputFormatter]="formatter" [resultTemplate]="rt"/>
					                        <span *ngIf="searching">searching...</span>
					                        <ng-template #rt let-r="result" let-t="term">
					                        	<img [src]="r.passport" style="width:30px; height:30px;">
					                           {{ r.first_name}} {{ r.middle_name}} {{ r.last_name}}
					                        </ng-template>
					                      </div>
                                        </div>
                                        <div class="col-md-2">
		                      				<div class="form-group">
				                                <label>Status</label>
				                                <select class="form-control" formControlName = "status">
				                                    <option selected="" value="">None</option>
				                                    <option value="1">Approve/Posted</option>
				                                    <option value="0">Pending/Pre-Posted</option>
				                                    <option value="2">Cancelled</option>
				                                </select>
				                            </div>
		                      			</div>
		                      			<div class="col-md-2">
						                  <div class="form-group">
						                    <label>Branch</label>
						                    <select tabindex="1" formControlName="branch_id" data-placeholder="Branch" class="form-control">
						                      <option value="" disabled="" selected="">Branch</option>
						                      <option *ngFor="let branch of vendor_branches" value="{{branch.id}}">{{branch?.name}}</option>
						                    </select>
						                  </div>
						                </div>
                                        <!-- <div class="col-md-3">
                                        	<label>Type</label>
	                                       	<select class="form-control" placeholder="Filter by name..." formControlName = "type">
	                                       		<option value="">None</option>
						                        <option value="{{ item.id }}" *ngFor="let item of contribution_type_list">{{ item?.name }}</option>
						                    </select>
	                                    </div> -->
                                        <div class="col-md-2">
                                          <div class="form-group">
                                            <button type="submit" class="btn btn-primary btn-block" style="margin-top:30px" [disabled]="filterForm.invalid && !submitPending">
                                              <span *ngIf="submitPending && filterForm.valid">Please Wait...</span>
                                              <span *ngIf="submitPending && filterForm.valid"><i class="fa fa-spinner"></i></span>
                                              <span *ngIf="!submitPending">Filter</span>
                                            </button>
                                          </div>
                                        </div>
                                      </div>
                                  </form>
			            	</div>
			            	<!-- <div class="row" *ngIf="show_bulk_contribution">
			            		<form [formGroup] = "bulk_plan_contribution_form" (ngSubmit) = "bulk_contribution(bulk_plan_contribution_form.value)" style="width: 100%;">
                                    <div class="row p-1">
                              
                                      <div class="col-md-3">
                                      	<div class="form-group">
			                                <label>Select Contribution Plan</label>
			                                <select class="form-control" placeholder="type" formControlName = "plan_id">
			                                    <option selected="false">Type</option>
			                                    <option [value]="item.id" *ngFor="let item of contribution_plan_list">
			                                    	{{item?.name }}
			                                    </option>
			                                </select>
			                                <small [hidden]="(bulk_plan_contribution_form.controls.plan_id.valid ) || (bulk_plan_contribution_form.controls.plan_id.pristine )" class="text-danger">Contribution Plan is Required</small>
			                            </div>
                                      </div>
		                      		
                                 
                                        <div class="col-md-2">
                                          <div class="form-group">
                                            <button type="submit" class="btn btn-primary" style="margin-top:30px" [disabled]="bulk_plan_contribution_form.invalid && !submitPending">
                                              <span *ngIf="submitPending && bulk_plan_contribution_form.valid">Please Wait...</span>
                                              <span *ngIf="submitPending && bulk_plan_contribution_form.valid"><i class="fa fa-spinner"></i></span>
                                              <span *ngIf="!submitPending">Filter</span>
                                            </button>
                                          </div>
                                        </div>
                                      </div>
                                  </form>
			            	</div> -->
			            	<div class="mt-3 mb-4">
			            		<button (click)="exportTable('xls', 'contri_table')" class="btn btn-outline btn-success">Export table</button>
                        		<button class="btn btn-outline btn-success ml-2" (click)="printReciept('contri_table')">Print</button>
                        		<!-- <a class="btn btn-success" [routerLink]="['/app/contributions/bulk-contributions']">Bulk Contributions</a> -->
			            	</div>
            				<mat-progress-bar *ngIf="submitPending" mode="indeterminate"></mat-progress-bar>

			            	<table id="contri_table" class="table table-responsive table-hover table-outline mb-3" width="100%">
				                <thead>
					                <tr>
					                    <th>Trans. ID</th>
					                    <th>Branch</th>
					                    <th>Name</th>
					                    <th>Plan</th>
					                    <th>(&#8358;) Contributed</th>
					                    <th>Type</th>
					                    <th>Date</th>
					                    <th>Status</th>
					                    <th>Depositor</th>
						                <th>Naration</th>
						                <th>Created</th>
					                    <th>Approved</th>
					                    <th>Actions</th>
					                </tr>
					            </thead>
					            <tbody>
					                <tr class="" *ngFor="let item of contibutionsList">
					                    <td>{{ item?.transaction_id }}</td>
					                    <td>{{ item?.branch?.name }}</td>
					                    <td>
					                        {{item?.member?.first_name}} 
					                        {{item?.member?.last_name}} 
					                        {{item?.member?.middle_name}} 
					                        </td>
					                    <td>
					                        {{ item?.plan?.name }} 
					                    </td>
					                    <td>
					                         {{ item?.amount | number:'.2' }}
					                    </td>
					                    <td>
					                        {{item?.type?.name}} 
										</td>
					                    <td>
					                        {{item?.created_at | date: 'shortDate'}} 
					                    </td>
					                    <td>
				                        	<span *ngIf="item.status == 0" class="badge badge-warning">Pending </span>
				                            <span *ngIf="item.status == 2" class="badge badge-danger">Cancelled </span>
                                    		<span *ngIf="item.status == 1" class="badge badge-success">Approved </span>
				                        </td>
				                        <td>
						                	{{ item?.depositor }}
						                </td>
						                <td>
						                	{{ item?.description}}
						                </td>
					                    <td>
					                         {{item?.staff?.first_name}} 
					                        {{item?.staff?.last_name}} 
					                        {{item?.staff?.middle_name}}
					                    </td>
					                    <td>
					                         {{item?.approved_by?.first_name}} 
					                        {{item?.approved_by?.last_name}} 
					                        {{item?.approved_by?.middle_name}}
					                    </td>
					                    <td class="center">
					                    	<mat-menu #appMenu="matMenu">
				                        		<mat-progress-bar *ngIf="btn_loader" mode="indeterminate"></mat-progress-bar>
											  <button [hidden]="item.status > 0" [swal]="post_contri_trans" mat-menu-item>Post Transaction</button>
											  <swal
												  #post_contri_trans
												  title="Are You Sure You want to Approve this Transaction?"
												  text="This cannot be undone"
												  type="warning"
												  [showCancelButton]="true"
												  [focusCancel]="true"
												  (confirm)="post_transaction(item, 1)">
												</swal>
												 <button *ngIf="item.status != 2" [swal]="cancel_contri_trans" mat-menu-item>Cancel Transaction</button>
											  <swal
												  #cancel_contri_trans
												  title="Are You Sure You want to Cancel this Transaction?"
												  text="This cannot be undone"
												  type="warning"
												  [showCancelButton]="true"
												  [focusCancel]="true"
												  (confirm)="post_transaction(item.id, 2)">
												</swal>
											</mat-menu>

											<button mat-icon-button *ngIf="localService.check_posting_cash_role(item.amount)" [matMenuTriggerFor]="appMenu">
											  <mat-icon>more_vert</mat-icon>
										</button>
					                        <!-- <div class="btn-group">
					                         
					                          <button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
					                            <span><i class="fa fa-ellipsis-v"></i></span>
					                          </button>
					                          <ul class="dropdown-menu" style="min-width:1px;">
					                            
					                            <li><a tabindex="-1" (click)="deleteMember(item.id)">Another action</a></li>
					                             <li class="divider"></li>
					                            <li>
					                                <button class="btn btn-small" (click)="deleteMember(item.id)" title="delete member">
					                                    <i class="fa fa-trash-o"></i>
					                                </button>
					                            </li>
					                             <li class="divider"></li>
					                          </ul>
					                        </div> -->
					                    </td>
					                </tr>
					            </tbody>
					        </table>
					        <br>
				            <div class="load-more">
	                           <a  (click)="loadMoreContributions()" style="cursor: pointer;" class="btn btn-success"><i *ngIf="loader" class="fa fa-spinner"></i>Load more... </a>
	                        </div>
			            </div>
		        	</tab>
		        	<tab heading='Bulk Contribution' *ngIf="user.role_id < 4">
		        		<app-run-contribution></app-run-contribution>
		        	</tab>
		    	</tabset>
			</div>
		</div>
	</div>
</div>

<div bsModal #excelUploadModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
     <div class="modal-dialog modal-md">
       <div class="modal-content">
         <div class="modal-header">
           <h4 class="modal-title pull-left">Upload Excel Format</h4>
           <button type="button" class="close pull-right" aria-label="Close" (click)="excelUploadModal.hide()">
             <span aria-hidden="true">&times;</span>
           </button>
         </div>
         <div class="modal-body">
         	<button class="btn btn-success"><a href="http://localhost:8000/excels/contributions-format.xls" target="_blank">generate Excel format</a></button>
           	<div class="new session form">
               	<form>
               		<div class="form-group">
               			please ensure it's the generated excel format you used else it wont upload
               		</div>
               		<div class="form-group">
               			<label>Contribution File</label>
               			<input id="fileChooseAFile" #data type="file" class="form-control" (change)="handleFile($event)"  name="fileChooseAFile" accept=".csv">
               		</div>
               		<!-- <div class="result-container" *ngIf="result && result.length>0">
					  <h2>
					    Result :
					   <br>
					  </h2>
					  {{result}}
					</div> -->
               		<div class="form-group">
               			<button class="btn btn-success">Upload</button>
               		</div>
               	</form>
            </div>
         </div>
       </div>
     </div>
</div>
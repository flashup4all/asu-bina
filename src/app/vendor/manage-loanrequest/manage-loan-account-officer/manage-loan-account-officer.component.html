<div class="cad">
    <div class="cad-body" style="padding:0px;">
    <div class="widget">
        <div class="row p-2">
            <div class="col">
                        <div class="container asu-card pt-3 pb-3 mt-2 mb-4">
                        	<p>Advance Loan Filter</p>
                            <form [formGroup] = "filterForm" (ngSubmit) = "advance_loan_filter(filterForm.value)" style="width: 100%;">
                            <div class="row">
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <label>From</label>
                                    <input type="date" formControlName = "from" class="form-control" name=""> 
                                  </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <label>To</label>
                                    <input type="date" formControlName = "to" class="form-control" name="">
                                  </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <label>Branch</label>
                                    <select tabindex="1" formControlName="branch_id" data-placeholder="Branch" class="form-control">
                                      <option value="" disabled="" selected="">Branch</option>
                                      <option *ngFor="let branch of vendor_branches" value="{{branch.id}}">{{branch?.name}}</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Loan Types</label>
                                        <select tabindex="1" formControlName="loan_type_id" data-placeholder="Branch" class="form-control">
                                            <option value="" disabled="" selected="">Loan types</option>
                                            <option [value]="item.id" *ngFor="let item of loanTypeList">{{ item.loan_type }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <label>Status</label>
                                    <select tabindex="1" formControlName="status" data-placeholder="Branch" class="form-control">
                                      <option value="" selected="">None</option>
                                      <option value="0" >Pending</option>
                                      <option value="1" >Active</option>
                                      <option value="2">Cancelled</option>
                                      <option value="3" >Completed | Closed</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <label for="typeahead-http">Account Officer <small>[Name/Staff ID]</small></label>
                                    <input id="typeahead-http" type="text" class="form-control" [class.is-invalid]="staff_searchFailed"formControlName="acc_officer_id" [ngbTypeahead]="search_staff" placeholder="Filter By Staff" [inputFormatter]="staff_formatter" [resultTemplate]="st"/>
                                    <span *ngIf="staff_searching">searching...</span>
                                    <ng-template #st let-r="result" let-t="term">
                                        <img *ngIf="!r.passport" src="assets/images/avata.png" class="img-avatar" width='39px'>
                                        <img *ngIf="r.passport" src="{{staff_image_url}}{{r.passport}}" class="img-avatar" width='39px'>
                                       {{ localService.check_for_empty_string(r.first_name) }} {{ localService.check_for_empty_string(r.last_name) }} {{ localService.check_for_empty_string(r.middle_name) }}
                                       <br>
                                       {{ r.staff_id}}
                                    </ng-template>
                                  </div>
                                </div>
                                <div class="col-md-3">
                                  <div class="form-group">
                                    <!-- <button type="button" class="btn btn-primary" style="margin-top: 30px;" (click)="show_adv_form()"><i class="fa fa-filter"></i></button> -->
                                    <button type="submit" class="btn btn-primary btn-block" style="margin-top:30px" [disabled]="filterForm.invalid && !submitPending">
                                      <span *ngIf="submitPending && filterForm.valid">Please Wait...</span>
                                      <span *ngIf="submitPending && filterForm.valid"><i class="fa fa-spinner"></i></span>
                                      <span *ngIf="!submitPending">Filter</span>
                                    </button>
                                  </div>
                                </div>
                              </div>
                          </form>
                        </div>
                        <div class=" asu-card  pt-4 pb-4 col-md-12">
                            <p>{{ result_msg }}</p>
                            <div class="mb-4 mt-4">
                                <button (click)="exportTable('xls', 'lloan_request_table')" class="btn btn-outline btn-success">Export table</button>
                                <button class="btn btn-outline btn-success ml-2" (click)="printReciept('lloan_request_table')">Print</button>
                            </div>
                            <table id="lloan_request_table" class="table table-responsive table-hover table-outline mb-4" width="100%">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Branch</th>
                                        <th>Name</th>
                                        <th>Loan Type (% Intr)</th>
                                        <th>Interest Type</th>
                                        <th>&#8358; Principal Amount</th>
                                        <th>&#8358; Total Paid</th>
                                        <th>Duration(Months)</th>
                                        <th>Current Balance</th>
                                        <th>Start Date</th>
                                        <th>Created</th>
                                        <th>Status</th>
                                        <th>Account Officer</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="" *ngFor="let item of loanRequestList let i=index">
                                        <td>{{ i+1 }}</td>
                                        <td>{{ item?.branch_name }}</td>
                                        <td>
                                            {{ localService.check_for_empty_string(item?.member_firstname) }} 
                                            {{ localService.check_for_empty_string(item?.member_lastname) }} 
                                            {{ localService.check_for_empty_string(item?.member_middlename) }} 
                                            </td>
                                        <td>
                                            {{ item?.setting_name }} ({{item?.setting_interest}})% 
                                        </td>
                                        <td>{{ filter_loan_interest_type(item?.interest_type) }}</td>
                                        <td>
                                            {{item?.amount | number: '1.2-2' }} 
                                        </td>
                                        <td>
                                            {{item?.total_repayment | number: '1.2-2' }}  
                                        </td>
                                        <!-- <td>
                                            {{item.monthly_deductions | number:'.2'}} 
                                        </td>
                                        <td>
                                            {{item.repayment_method}} 
                                        </td> -->
                                        <td>
                                            {{item?.setting_duration}} 
                                        </td>
                                        <td>
                                            {{ item?.loan_balance | number: '1.2-2' }} 
                                        </td>
                                        <td>
                                            {{item?.start_date |date}} <!-- <p style="color: red">({{ count_no_loan_days(item?.start_date) }})</p> -->
                                        </td>
                                          <td>
                                            {{ item?.created_at }} 
                                        </td>
                                        <td>
                                            <span *ngIf="item.status == 0" class="badge badge-warning">Pending </span>
                                            <span *ngIf="item.status == 2" class="badge badge-danger">Cancelled </span>
                                            <span *ngIf="item.status == 1" class="badge badge-success">Approved </span>
                                            <span *ngIf="item.status == 3" class="badge badge-primary">Closed </span>
                                        </td>
                                        <td>
                                            {{ localService.check_for_empty_string(item.staff_first_name) }}
                                            {{ localService.check_for_empty_string(item.staff_middle_name) }}
                                            {{ localService.check_for_empty_string(item.staff_last_name) }}
                                        </td>
                                        <td class="center">
                                            
                                            <mat-menu #requestappMenu="matMenu">
                                                <mat-progress-bar *ngIf="approve_btn_loader" mode="indeterminate"></mat-progress-bar>
                                                <button mat-menu-item (click)="requestHistory(item.id)">Request History</button>
                                            </mat-menu>
                                            <button *ngIf="item.status != 2 && user.role_id != 4" [matMenuTriggerFor]="requestappMenu" class="btn btn-primary btn-sm">
                                              <i class="fa fa-sliders"> </i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- <div class="mb-4 load-more">
                               <a  (click)="loadMore()" class="btn btn-success" style="cursor: pointer;"><i *ngIf="loader" class="fa fa-spinner"></i>Load more... </a>
                            </div> -->
                        </div>
                    
            </div>
        </div>
    </div>
    </div>
</div>
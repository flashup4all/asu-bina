<div class="row">
    
   <div class="container p-2">
     <button (click)="exportTable('xls', 'withdrawal_table')" class="btn btn-outline btn-success">Export table</button>
     <button class="btn btn-outline btn-success" (click)="printReciept('withdrawal_table')">Print</button>
     <button type="button" class="btn btn-primary pull-right" (click)="newWithdrawalModal.show()"> Make a Withdrawal</button>
 </div>
  <table id="withdrawal_table" class="table table-responsive-sm table-hover table-outline mb-0" width="100%">
      <thead>
          <tr>
              <th>Trans ID</th>
              <th>Branch</th>
              <th>Name</th>
              <th>Plan</th>
              <th> &#8358; Amount</th>
              <th>Status</th>
              <th>Date</th>
              <th>Created By</th>
              <th>Approved</th>
              <th>Actions</th>
          </tr>
      </thead>
      <tbody>
          <tr class="" *ngFor="let item of withdrawal_list">
              <td>#00{{ item?.id }}</td>
              <td>{{ item?.branch?.name }}</td>
              <td>
                  {{item?.member?.first_name}} 
                  {{item?.member?.last_name}} 
                  {{item?.member?.middle_name}} 
              </td>
              <td>
                 {{item?.plan?.name}}  
              </td>
              <td>
                 {{ item?.amount  | number }}  
              </td>
                <td>
                  <span *ngIf="item.status == 0" class="badge badge-warning">Pending </span>
                  <span *ngIf="item.status == 2" class="badge badge-danger">Cancelled </span>
                  <span *ngIf="item.status == 1" class="badge badge-success">Approved </span>
              </td>
              <td>
                  {{item?.created_at | date: 'shortDate'}} 
              </td>
              <td>
                {{ item?.staff?.first_name}} 
                {{ item?.staff?.last_name}} 
                {{ item?.staff?.middle_name}}
              </td>
              <td>
                {{ item?.approved_by?.first_name}} 
                {{ item?.approved_by?.last_name}} 
                {{ item?.approved_by?.middle_name}}
              </td>
              <td class="center">
                <mat-menu #appMenu="matMenu">
                  <button [swal]="approve_request" [disabled]="btn_loader" mat-menu-item *ngIf="item.status==0">Approve Request</button>
                  <mat-progress-bar *ngIf="btn_loader" mode="indeterminate"></mat-progress-bar>
                  <button [swal]="cancel_request" [disabled]="btn_loader" mat-menu-item *ngIf="item.status == 0 ">Cancel Request</button>
                  <swal
                    #approve_request
                    title="Are You Sure You want to Approve this Withdrawal?"
                    text="This cannot be undone"
                    type="warning"
                    [showCancelButton]="true"
                    [focusCancel]="true"
                    (confirm)="approveWidthdrawalRequest(item.id)">
                  </swal>
                  <swal
                    #cancel_request
                    title="Are You Sure You want to Cancel this Withdrawal?"
                    text="This cannot be undone"
                    type="warning"
                    [showCancelButton]="true"
                    [focusCancel]="true"
                    (confirm)="cancelWidthdrawalRequest(item.id)">
                  </swal>
                </mat-menu>

                <button *ngIf="item.status != 2 && localService.check_posting_cash_role(item.amount)" mat-icon-button [matMenuTriggerFor]="appMenu">
                  <mat-icon>more_vert</mat-icon>
                </button>
            </td>
          </tr>
          <tr>
              <td colspan="3">Total</td>
              <td>{{ total_contribution_amount | number }}</td>
              <td></td>
          </tr>
      </tbody>
  </table>
</div>
<div bsModal #newWithdrawalModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
     <div class="modal-dialog modal-md">
       <div class="modal-content">
         <div class="modal-header">
           <h4 class="modal-title pull-left">Make A Withdrawal</h4>
           <button type="button" class="close pull-right" aria-label="Close" (click)="newWithdrawalModal.hide()">
             <span aria-hidden="true">&times;</span>
           </button>
         </div>
         <div class="modal-body">
           <div class="new session form">
                <form [formGroup]="withdrawalForm" (ngSubmit)="make_a_withdrawal(withdrawalForm.value)">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Contribution Plan</label>
                                <select class="form-control" placeholder="type" formControlName = "plan_id">
                                    <option selected="false">Type</option>
                                    <option [value]="item.contribution_plan.id" *ngFor="let item of member_plan_list">
                                      {{item?.contribution_plan?.name }}
                                    </option>
                                </select>
                                <small [hidden]="(withdrawalForm.controls.plan_id.valid ) || (withdrawalForm.controls.plan_id.pristine )" class="text-danger">Savings Plan is Required</small>
                            </div>
                            <div class="form-group">
                                <label>Amount</label>
                                <input type="text" name="" formControlName = "amount" class="form-control">
                                <small [hidden]="(withdrawalForm.controls.amount.valid ) || (withdrawalForm.controls.amount.pristine )" class="text-danger">Amount Required</small>
                            </div>
                        </div>
                       <!--  <div class="col-md-6">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea formControlName = "description" class="form-control"></textarea>
                            </div>
                        </div> -->
                    </div>
                       <button type="submit" class="btn btn-success" [disabled]="withdrawalForm.invalid || submitPending">
                            <span *ngIf="!submitPending">Request Withdrawals</span>
                            <span *ngIf="submitPending && withdrawalForm.valid">Please Wait...</span>
                            <span *ngIf="submitPending && withdrawalForm.valid" class="fa fa-spinner" aria-hidden="true"></span>
                        </button>
                </form>
            </div>
         </div>
       </div>
     </div>
</div>